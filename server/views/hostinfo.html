{% extends 'layout.html' %}

{% block main %}
<div class="host__container">
    <div class="hostinfo__container">

        <div class="hostinfo__title">
            <div id="hostinfo__title">
                <h2>{{host.title}}</h2>
            </div>
            <div id="hostinfo__middletitle">
                <div id="middletitle__city">
                    <p>{{host.city}}</p>
                </div>
                {% if not favoritesList.includes( host.id ) %}
                <div id="middletitle__like">
                    <a href="#" id="likeBtn"><i class="far fa-heart" id="like"></i></a>
                </div>
                {% else %}
                <div id="middletitle__unlike">
                    <a href="#" id="unlikeBtn"><i class="far fa-heart" id="unlike"></i></a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Image -->
        <div class="hostinfo__Image">
            {% for image in host.Images %}
            <div class="image" id="image{{loop.index}}">
                <img src="../{{image.src}}" alt="" />
            </div>

            {% endfor %}
            {% if host.Images.length < 5 %} <div class="image">
        </div>
        {% endif %}
    </div>

    <!-- info -->
    <div class="hosting__info">
        <div class="hosting__name">
            <h2>{{host.User.nickname}}ë‹˜ì˜ í˜¸ìŠ¤íŒ… ì •ë³´</h2>
            <div class="simple__info">
                <p>ì¸ì› : {{host.person}} </p>
                <p>ì¹¨ì‹¤ : {{host.roominfo_room}} </p>
                <p>ìš•ì‹¤ : {{host.roominfo_bathroom}} </p>
            </div>
        </div>

        <div class="hostig__roominfo">
            {{host.hostinfo}}
        </div>

        <div class="hosting__bed">
            <h2>ì¹¨êµ¬/ì¹¨ëŒ€ ìœ í˜•</h2>

            <div id="bedicon">
                <i class="fas fa-bed"></i>
                <p>{{host.roominfo_bed}}</p>
            </div>
        </div>

        <div class="date__div">
            <h2>ì²´í¬ì¸ ë‚ ì§œë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
            <p>ì—¬í–‰ ë‚ ì§œë¥¼ ì„ íƒí•˜ì‹œë©´ ì˜ˆì•½ì´ ê°€ëŠ¥í•œì§€ í™•ì¸ í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            <div class="datepicker">
                <h2>ì—¬í–‰ ì¼ì •ì„ ì„ íƒí•´ì£¼ì„¸ìš”</h2>
                <div id="datepicker">
                    <div id="checkin">
                        <p>ì²´í¬ì¸</p>
                        <input type="text" placeholder="ë‚ ì§œì„ íƒ" id="checkinfilter" name="checkinfilter" value="" />
                    </div>
                    <div id="checkout">
                        <p>ì²´í¬ì•„ì›ƒ</p>
                        <input type="text" placeholder="ë‚ ì§œì„ íƒ" id="checkoutfilter" name="checkoutfilter" value="" />
                    </div>
                </div>

                <button id="order__btn">ì˜ˆì•½ ê°€ëŠ¥ ì—¬ë¶€ ë³´ê¸°</button>
            </div>
        </div>
    </div>
    <!-- ë¦¬ë·° div -->
    <div class="hostinfo__review__div">
        <h2>í›„ê¸°</h2>
        <a href="#" id="allRivew">ë¦¬ë·° ë”ë³´ê¸°..</a>
    </div>
    <div class="hostinfo__riview__content">
        {% if host.Reviews.length !== 0 %}
        {% for review in host.Reviews %}
        <div id="hostinfo__review__content">
            <div id="review__top">
                <h3>{{review.User.name}} ë‹˜</h3>
                <p>
                    {{review.satisfaction}}
                    {% if review.satisfaction === "ë§¤ìš° ë§Œì¡±" %}
                    ğŸ‘ğŸ‘
                    {% elif review.satisfaction === "ë§Œì¡±" %}
                    ğŸ‘
                    {% elif review.satisfaction === "ë³´í†µ" %}
                    ğŸ‘Œ
                    {% elif review.satisfaction === "ë¶ˆë§Œì¡±" %}
                    ğŸ‘
                    {% else %}
                    ğŸ‘ğŸ‘
                    {% endif %}
                </p>
            </div>
            <p>{{review.Reservation.checkIn}} ~ {{review.Reservation.checkout}}ì˜ ì¼ì •</p>
            <h4>{{review.comment}}</h4>
        </div>
        {% endfor %}
        {% else %}
        <h2>ì‘ì„±ëœ ë¦¬ë·°ê°€ ì•„ì§ ì—†ìŠµë‹ˆë‹¤..</h2>
        {% endif %}
    </div>
</div>

{% endblock %}
{% block script %}
<script>
    $(function () {

        $('input[name="checkinfilter"], input[name="checkoutfilter"]').daterangepicker({
            autoUpdateInput: false,
            //minDate: new Date()
        });

        $('input[name="checkinfilter"], input[name="checkoutfilter"]').on('apply.daterangepicker', function (ev, picker) {
            $('input[name="checkinfilter"]').val(picker.startDate.format('YYYY/MM/DD'));
            $('input[name="checkoutfilter"]').val(picker.endDate.format('YYYY/MM/DD'));
            //console.log(picker.startDate.format('YYYY/MM/DD'));
        });

    });


    document.querySelector('#order__btn').addEventListener('click', function () {
        const checkin = document.querySelector('#checkinfilter').value;
        const checkout = document.querySelector('#checkoutfilter').value;

        axios.post(`/reservation/reservationChecking/{{host.id}}`, { checkin, checkout })
            .then((response) => {
                if (response.data.success) {
                    const result = confirm('ì˜ˆì•½ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤. ì˜ˆì•½ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?');
                    if (result) {
                        const checkin = response.data.checkin;
                        const checkout = response.data.checkout;
                        return window.location = `/reservation/{{host.id}}?checkin=${checkin}&checkout=${checkout}`;
                    }
                    return location.reload();
                }
                alert('ì„ íƒí•˜ì‹  ë‚ ì§œì— ì´ë¯¸ ì˜ˆì•½ì´ ìˆìŠµë‹ˆë‹¤.');
                return location.reload();
            })
            .catch((error) => {
                console.error(error);
                return alert(error);
            });
    });

    document.getElementById('likeBtn').addEventListener('click', function () {
        axios.put(`/favorites/add/{{host.id}}`, {})
            .then((response) => {
                if (response.data.success) {
                    alert(response.data.message);
                    return location.reload();
                } else {
                    alert(response.data.message);
                    return location.reload();
                }
            })
            .catch((error) => {
                return alert(errro);
            });
    });


</script>
{% endblock %}